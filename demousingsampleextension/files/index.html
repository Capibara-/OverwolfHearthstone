<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>Ninja App</title>
 
</head>

<body>

    <div id="content" onmousedown="dragMove();">
        <h1>Ninja App</h1>
        <button id="close" onclick="closeWindow();">Close</button>
       
        <br />


        <table id="myTable" width="100%" style="height: 100%;" border="0">
            <tr>
                <td></td>
                <td></td>
            </tr>
        </table>
            

</div>
    <script language="javascript">
    function dragResize(edge) {
        overwolf.windows.getCurrentWindow(function (result) {
            if (result.status == "success") {
                overwolf.windows.dragResize(result.window.id, edge);
            }
        });
    };

    function dragMove() {
        overwolf.windows.getCurrentWindow(function (result) {
            if (result.status == "success") {
                overwolf.windows.dragMove(result.window.id);
            }
        });
    };

    function closeWindow() {
        overwolf.windows.getCurrentWindow(function (result) {
            if (result.status == "success") {
                overwolf.windows.close(result.window.id);
            }
        });
    };

    function openSubWindow() {
        alert("the subwindow will only be visible inside a game");
        overwolf.windows.obtainDeclaredWindow("SubWindow", function (result) {
            if (result.status == "success") {
                overwolf.windows.restore(result.window.id, function (result) {
                    console.log(result);
                });
            }
        });
    };

    function takeScreenshot() {
        overwolf.media.takeScreenshot(function (result) {
            if (result.status == "success") {
                var img = document.getElementById("screenshot");
                img.src = result.url;
                img.onload = function () {
                    overwolf.media.shareImage(img, "Screen Shot");
                };
            }
        });
    }

    function runTeamSpeak() {
        overwolf.extensions.launch("lafgmhfbkjljkgoggomibmhlpijaofafbdhpjgif");
    };

    var sampleLibraryObj = null;

    function initLibrary() {
        if (typeof (overwolf) != "undefined") {
            overwolf.extensions.current.getExtraObject("sampleLibrary", function (result) {        
                console.log("startup " + result.status);
                if (result.status == "success") {
                    sampleLibraryObj = result.object;       
                    sampleLibraryObj.CardHandEvent.addListener(cardHandEventFired);
                    sampleLibraryObj.CardPlayedEvent.addListener(cardPlayedEventFired);
                        sampleLibraryObj.init(function (result) {
                           console.log("init success:");
                           //console.log(result);
                        });
                   
                }
            });
            // Register a listener for the event defined in the C# dll, this will enable async calls from the dll to the JS.
           // sampleLibraryObj.sampleEvent.addListener(sampleEventFired);
        }

    }





    function cardPlayedEventFired(result) {
        console.log("cardPlayedEventFired:");
        var Cards = JSON.parse(result.CardJSON);
        console.log(Cards.Name);
        var found = false;
        var table = document.getElementById("myTable");
        if (table != null)
        for (var i = 0, row; row = table.rows[i] ; i++) {
            if (row.cells[0].innerHTML == Cards.Name) {
                cell = row.cells[1];
                if (cell.children[0].style.border != "5px solid black") {
                    cell.children[0].style.border = "5px solid black";
                    found = true;
                }
            }
            if (found == true)
                break;
        }
        if (found == false) {
            cardHandEventFired(result)
            table.rows[0].cells[1].children[0].border = "5px solid black";
            
        }
        console.log(result.CardJSON);
    }


    function cardHandEventFired(result) {
        console.log("cardHandEvent:");
        var Cards = JSON.parse(result.CardJSON);
        console.log(Cards.Name);
        var table = document.getElementById("myTable");
        var row = table.insertRow(0);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        cell1.innerHTML = Cards.Name;

        console.log(Cards.Name);
        var img = new Image();
        img.src = "Images_renamed/" + Cards.CardId + ".png";
        cell2.appendChild(img);
        console.log(result.CardJSON);
    }


    function sampleEventFired(result) {
        console.log("sampleEventFired: yaaaaa");
        console.log(result);
    }

    window.onload = function (e) {
        initLibrary();
    }

    </script>



    </div>
</body>
</html>
