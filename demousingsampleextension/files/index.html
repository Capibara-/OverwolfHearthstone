﻿<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="style.css" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>Ninja App</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script>
        $('[data-toggle="tooltip"]').tooltip();
        console.log("Initializing tooltips.");
    </script>
</head>

<body>

    <div id="content" onmousedown="dragMove();">
        <button id="close" onclick="closeWindow();">Close</button>
        <button id="Opponent" onclick="openOpponentWindow()">Opponent</button>
    </div>


    <script language="javascript">

        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });

        $('#sidebar').affix({
            offset: {
                top: $('header').height()
            }
        });
        function addImageToBar(path) {
            addImageToBarWithTooltip(path, "No info.", "cardThumbnail");
        }

        function addImageToBarWithTooltip(path, tooltipTitle, id) {
            console.log(tooltipTitle);
            $('#content').prepend('<div class="thumbnail" data-toggle="tooltip" data-placement="bottom" title=\"' + tooltipTitle + '\" id=\"' + id +'\"> <img src=\"' + path + '\" class="img-responsive"></div>');
            $('[data-toggle="tooltip"]').tooltip();
        }


        function dragResize(edge) {
            overwolf.windows.getCurrentWindow(function (result) {
                if (result.status == "success") {
                    overwolf.windows.dragResize(result.window.id, edge);
                }
            });
        };

        function dragMove() {
            overwolf.windows.getCurrentWindow(function (result) {
                if (result.status == "success") {
                    overwolf.windows.dragMove(result.window.id);
                }
            });
        };

        function closeWindow() {
            overwolf.windows.getCurrentWindow(function (result) {
                if (result.status == "success") {
                    overwolf.windows.close(result.window.id);
                }
            });
        };

        function openSubWindow() {
            alert("the subwindow will only be visible inside a game");
            overwolf.windows.obtainDeclaredWindow("SubWindow", function (result) {
                if (result.status == "success") {
                    overwolf.windows.restore(result.window.id, function (result) {
                        console.log(result);
                    });
                }
            });
        };

        function takeScreenshot() {
            overwolf.media.takeScreenshot(function (result) {
                if (result.status == "success") {
                    var img = document.getElementById("screenshot");
                    img.src = result.url;
                    img.onload = function () {
                        overwolf.media.shareImage(img, "Screen Shot");
                    };
                }
            });
        }

        function runTeamSpeak() {
            overwolf.extensions.launch("lafgmhfbkjljkgoggomibmhlpijaofafbdhpjgif");
        };

        var sampleLibraryObj = null;

        function initLibrary() {
            if (typeof (overwolf) != "undefined") {
                overwolf.extensions.current.getExtraObject("NinjaLibrary", function (result) {
                    console.log("startup " + result.status);
                    if (result.status == "success") {
                        sampleLibraryObj = result.object;
                        sampleLibraryObj.CardHandEvent.addListener(cardHandEventFired);
                        sampleLibraryObj.CardPlayedEvent.addListener(cardPlayedEventFired);
                            sampleLibraryObj.init(function (result) {
                               console.log(result);
                            });

                    }
                });
            }

        }

        function cardPlayedEventFired(result) {
            var Card = JSON.parse(result.CardJSON);
            console.log("Player moved " + Card.Name + " from hand to table.");
            if ($('#'+Card.ID).length == 0) {
                //card does not exist insert it to table and then change border
                cardHandEventFired(result);
            }
            $('#' + Card.ID).css('opacity', '0.5');
        }



        function cardHandEventFired(result) {
            var Card = JSON.parse(result.CardJSON);
            console.log("Player received " + Card.Name + " from deck.");
            var path = "Images_renamed/" + Card.ID + ".png";
            addImageToBarWithTooltip(path, Card.Name, Card.ID);
        }


        function sampleEventFired(result) {
            console.log(result);
        }

        window.onload = function (e) {
            initLibrary();
            //initSize();
        }

        function initSize() {
            overwolf.games.onGameLaunched.addListener(
                function (gameInfoObject) {
                    alert("width: " + gameInfoObject.width + " height: " + gameInfoObject.height);
                    $('#content').width(gameInfoObject.width);
                    $('#content').height(gameInfoObject.height);
                    overwolf.windows.changeSize("PlayerWindow", gameInfoObject.width, gameInfoObject.height, function () { console.log('Window size changed.') });
                }
                );
        }

        function openOpponentWindow() {
            overwolf.windows.obtainDeclaredWindow("OpponentWindow", function (result) {
                if (result.status == "success") {
                    overwolf.windows.restore(result.window.id, function (result) {
                        console.log(result);
                    });
                }
            });
        };

    </script>
</body>
</html>
